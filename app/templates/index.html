<!doctype html>
<html lang="en">

<head>
  <title>Mexican Pizza Locator</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" />
  <link rel="shortcut icon" href="{{ url_for('static', filename='pizza_2.ico') }}">
  <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-T53GN3PV6M"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-T53GN3PV6M');
  </script>
  <style>
    /* Chrome, Safari, Edge, Opera */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    
    /* Firefox */
    input[type=number] {
      -moz-appearance: textfield;
    }
    </style>
</head>

<body style="background-color: #1e293b;">
  <h1 class="text-center text-light" style="padding-top:2%;">Mexican Pizza Locator üçï </h1>
  <p class="text-center text-light">It just got back and it's always out of stock! Enter your zip code here to see if the mexican pizza is back in stock near you :) </p>
  <!-- <div class="row justify-content-center"> -->
  <form class="form-inline justify-content-center"  id='zip_code_form' action="javascript:getLocations()" >
    <div class="form-group mb-2">
      <label for="zip_code" class="sr-only">Zip Code</label>
      <input type="number" class="form-control" name="zip_code" id="zip_code" placeholder="Enter Zip Code" style="padding-right:10px;" required>
    </div>
    <button type="submit" class="btn btn-primary mb-2" style="margin-left:10px;">Submit</button>
  </form>
      <div class="row justify-content-center text-light" style="padding-top:5px;padding-bottom:5px;">
        <div id='spinner' class="spinner-border text-light justify-content-center text-center" role="status">
          <span class="visually-hidden text-light justify-content-center text-center" ></span>
        </div>
        <div  id='error-msg' class="alert alert-danger" role="alert">
          A simple danger alert‚Äîcheck it out!
        </div>
      </div>

  <!-- </div> -->

  <div class="text-center">
    <div id="test-map" class="text-center" name='test-map' style="height: 70vh; width:95%;margin:auto;text-align: center;"></div>
  </div>

  

  <script>

    var map = L.map('test-map').setView([37.3861, -122.0839], 12)
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition((position) => {
            map.panTo(L.latLng(position.coords.latitude, position.coords.longitude))
        })
    }
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Open street map'
    }).addTo(map)

    var MapIcon = L.Icon.extend({
        options: {
          iconSize:     [40, 40],
          shadowSize:   [50, 64],
          iconAnchor:   [22, 94],
          shadowAnchor: [4, 62],
          popupAnchor:  [-3, -76]
        }
    });

    var pizzaIcon = new MapIcon({
    iconUrl: 'https://cdn-icons-png.flaticon.com/512/3595/3595458.png',
})

var sadIcon = new MapIcon({
    iconUrl: 'https://cdn-icons-png.flaticon.com/512/599/599426.png',
})
var layerGroup = L.layerGroup().addTo(map);
var api_url = window.location.href;
console.log(api_url)

var spinnerElem = document.getElementById("spinner");
var errorElem = document.getElementById("error-msg");
spinnerElem.style.display = "none";
errorElem.style.display = "none";
    function getLocations() {
      errorElem.style.display = "none";
      const form = document.getElementById('zip_code_form');
      const zip_code = form['zip_code'].value
      spinnerElem.style.display = "block";
      axios.get(api_url + 'geojson-features?zip_code='+zip_code+'&store=Taco+Bell&item=Mexican+Pizza')
        .then(response => {
           layerGroup.clearLayers();
            console.log(response.data);
            // map.geoJSON(response.data, {}).addTo(map);
            console.log('hi')
            if(response.data['status'] === "success"){
              map.panTo(L.latLng(response.data['markers'][0]['lat'],response.data['markers'][0]['lng']))
              for (var i = 0; i < response.data.markers.length; i++) {
                  let currIcon = sadIcon;
                  if(response.data.markers[i]['has_pizza']){
                    currIcon = pizzaIcon;
                  }
                  marker = new L.marker([response.data.markers[i]['lat'], response.data.markers[i]['lng']], {icon: currIcon})
                    .bindPopup(response.data.markers[i]['popup']).openPopup()
                    .addTo(layerGroup);
              }

            }
            if(response.data['status'] === "failure"){
              errorElem.style.display = "block";
              errorElem.innerHTML = response.data['error']['error']
            }
            spinnerElem.style.display = "none";
        })  
    }

  </script>

<div class="text-center text-light" style="padding-top:20px;">
  <p>Thanks for visiting! If you're a fan of this project, please help me keep the lights on!</p>
  <a href="https://www.buymeacoffee.com/amittallapE"><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a pizza&emoji=üçï&slug=amittallapE&button_colour=BD5FFF&font_colour=ffffff&font_family=Poppins&outline_colour=000000&coffee_colour=FFDD00" /></a>  <p style="padding-top:5px;">Made by <a href="https://twitter.com/penguinsawce">Amit Tallapragada</a></p>
</div>


 

</body>

</html>
